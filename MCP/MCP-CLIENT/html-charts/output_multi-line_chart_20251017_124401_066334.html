<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js Multi-line Chart</title>
    <style>
.domain { stroke-width: 1.5; }

        body {
            font-family: Arial, sans-serif;
        }
        svg {
            font-size: 10px;
        }
        .axis-label {
            font-weight: bold;
        }
        .legend {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 6px;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            width: auto;
            height: auto;
            padding: 5px;
            background: lightgrey;
            border: 1px solid #bbb;
            border-radius: 5px;
            pointer-events: none;
        }
    </style>
</head>
<body>

<div id="chart"></div>
<div id="legend" class="legend"></div>
<div id="tooltip" class="tooltip" style="opacity: 0;"></div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
    const data = [
        {"week_start":"2025-01-01","week_end":"2025-01-05","total_capacity":19.126436781609193,"allocation_hours_planned":4.9126436781609195,"cumulative_actual":0},
        {"week_start":"2025-01-06","week_end":"2025-01-12","total_capacity":31.877394636015325,"allocation_hours_planned":8.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-01-13","week_end":"2025-01-19","total_capacity":31.877394636015325,"allocation_hours_planned":8.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-01-20","week_end":"2025-01-26","total_capacity":31.877394636015325,"allocation_hours_planned":8.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-01-27","week_end":"2025-02-02","total_capacity":31.877394636015325,"allocation_hours_planned":8.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-02-03","week_end":"2025-02-09","total_capacity":31.877394636015325,"allocation_hours_planned":8.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-02-10","week_end":"2025-02-16","total_capacity":31.877394636015325,"allocation_hours_planned":8.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-02-17","week_end":"2025-02-23","total_capacity":31.877394636015325,"allocation_hours_planned":8.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-02-24","week_end":"2025-03-02","total_capacity":31.877394636015325,"allocation_hours_planned":8.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-03-03","week_end":"2025-03-09","total_capacity":31.877394636015325,"allocation_hours_planned":10.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-03-10","week_end":"2025-03-16","total_capacity":31.877394636015325,"allocation_hours_planned":10.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-03-17","week_end":"2025-03-23","total_capacity":31.877394636015325,"allocation_hours_planned":10.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-03-24","week_end":"2025-03-30","total_capacity":31.877394636015325,"allocation_hours_planned":10.187739463601533,"cumulative_actual":0},
        {"week_start":"2025-03-31","week_end":"2025-04-06","total_capacity":31.877394636015325,"allocation_hours_planned":6.037547892720307,"cumulative_actual":0},
        {"week_start":"2025-04-07","week_end":"2025-04-13","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-04-14","week_end":"2025-04-20","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-04-21","week_end":"2025-04-27","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-04-28","week_end":"2025-05-04","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-05-05","week_end":"2025-05-11","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-05-12","week_end":"2025-05-18","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-05-19","week_end":"2025-05-25","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-05-26","week_end":"2025-06-01","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-06-02","week_end":"2025-06-08","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-06-09","week_end":"2025-06-15","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-06-16","week_end":"2025-06-22","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-06-23","week_end":"2025-06-29","total_capacity":31.877394636015325,"allocation_hours_planned":5.0,"cumulative_actual":0},
        {"week_start":"2025-06-30","week_end":"2025-07-06","total_capacity":31.877394636015325,"allocation_hours_planned":25.0,"cumulative_actual":0},
        {"week_start":"2025-07-07","week_end":"2025-07-13","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-07-14","week_end":"2025-07-20","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-07-21","week_end":"2025-07-27","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-07-28","week_end":"2025-08-03","total_capacity":25.50191570881226,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-08-04","week_end":"2025-08-10","total_capacity":0.0,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-08-11","week_end":"2025-08-17","total_capacity":0.0,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-08-18","week_end":"2025-08-24","total_capacity":0.0,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-08-25","week_end":"2025-08-31","total_capacity":0.0,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-09-01","week_end":"2025-09-07","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-09-08","week_end":"2025-09-14","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-09-15","week_end":"2025-09-21","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-09-22","week_end":"2025-09-28","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-09-29","week_end":"2025-10-05","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-10-06","week_end":"2025-10-12","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-10-13","week_end":"2025-10-19","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-10-20","week_end":"2025-10-26","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-10-27","week_end":"2025-11-02","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-11-03","week_end":"2025-11-09","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-11-10","week_end":"2025-11-16","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-11-17","week_end":"2025-11-23","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-11-24","week_end":"2025-11-30","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-12-01","week_end":"2025-12-07","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-12-08","week_end":"2025-12-14","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-12-15","week_end":"2025-12-21","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-12-22","week_end":"2025-12-28","total_capacity":31.877394636015325,"allocation_hours_planned":30.0,"cumulative_actual":0},
        {"week_start":"2025-12-29","week_end":"2025-12-31","total_capacity":19.126436781609193,"allocation_hours_planned":18.0,"cumulative_actual":0}
    ];

    const margin = {top: 20, right: 30, bottom: 50, left: 60},
          width = 960 - margin.left - margin.right,
          height = 500 - margin.top - margin.bottom;

    const svg = d3.select("#chart").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    const parseDate = d3.timeParse("%Y-%m-%d");

    const x = d3.scaleTime()
        .range([0, width]);

    const y = d3.scaleLinear()
        .range([height, 0]);

    const color = d3.scaleOrdinal()
        .domain(["Total Capacity", "Planned Allocation", "Actual Allocation"])
        .range(["#1f77b4", "#ff7f0e", "#2ca02c"]);

    const xAxis = d3.axisBottom(x).tickFormat(d3.timeFormat("%b %d, %Y"));
    const yAxis = d3.axisLeft(y);

    const line = d3.line()
        .x(d => x(d.date))
        .y(d => y(d.value));

    const linesData = [
        {
            name: "Total Capacity",
            values: data.map(d => ({date: parseDate(d.week_start), value: d.total_capacity}))
        },
        {
            name: "Planned Allocation",
            values: data.map(d => ({date: parseDate(d.week_start), value: d.allocation_hours_planned}))
        },
        {
            name: "Actual Allocation",
            values: data.map(d => ({date: parseDate(d.week_start), value: d.cumulative_actual}))
        }
    ];

    x.domain(d3.extent(data, d => parseDate(d.week_start)));
    y.domain([0, d3.max(linesData, c => d3.max(c.values, v => v.value))]);

    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", `translate(0,${height})`)
        .call(xAxis)
        .append("text")
        .attr("class", "axis-label")
        .attr("x", width)
        .attr("y", -10)
        .style("text-anchor", "end")
        .text("Week Start Date");

    svg.append("g")
        .attr("class", "y axis")
        .call(yAxis)
        .append("text")
        .attr("class", "axis-label")
        .attr("transform", "rotate(-90)")
        .attr("y", 15)
        .style("text-anchor", "end")
        .text("Hours");

    const tooltip = d3.select("#tooltip");

    const lineSvg = svg.selectAll(".line")
        .data(linesData)
        .enter().append("g");

    lineSvg.append("path")
        .attr("class", "line")
        .attr("d", d => line(d.values))
        .style("stroke", d => color(d.name))
        .style("fill", "none")
        .on("mouseover", () => tooltip.style("opacity", 1))
        .on("mousemove", (event, d) => {
            const date = x.invert(d3.pointer(event)[0]);
            const formatTime = d3.timeFormat("%b %d, %Y");
            tooltip.html(`${d.name}<br/>Date: ${formatTime(date)}`)
                .style("left", (event.pageX + 5) + "px")
                .style("top", (event.pageY - 10) + "px");
        })
        .on("mouseout", () => tooltip.style("opacity", 0));

    const legend = d3.select("#legend");

    legend.selectAll(".legend-item")
        .data(linesData)
        .enter()
        .append("div")
        .attr("class", "legend-item")
        .attr("id", d => d.name.replace(" ", "-"))
        .html(d => `<div class="legend-color" style="background-color: ${color(d.name)}"></div>${d.name}`);
</script>

</body>
</html>