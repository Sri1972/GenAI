<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Line Chart with Legend and Tooltip</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
.domain { stroke-width: 1.5; }

        body {
            font-family: 'Arial', sans-serif;
        }
        .chart-container {
            margin: 50px;
        }
        .axis-label {
            font-size: 14px;
        }
        .legend {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
            font-size: 14px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .tooltip {
            position: absolute;
            opacity: 0;
            background-color: white;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            pointer-events: none;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <svg id="chart" width="960" height="500"></svg>
        <div class="legend" id="legend"></div>
        <div class="tooltip" id="tooltip"></div>
    </div>

    <script>
        const data = [
            /* Inserted JSON data */
            {"week_start":"2025-01-01","week_end":"2025-01-05","total_capacity":19.126436781609193,"allocation_hours_planned":4.9126436781609195,"allocation_hours_actual":0,"available_capacity":14.213793103448275,"total_capacity_cumulative":19.126436781609193,"cumulative_planned":4.9126436781609195,"cumulative_actual":0,"available_capacity_cumulative":14.213793103448275},
            {"week_start":"2025-01-06","week_end":"2025-01-12","total_capacity":31.877394636015325,"allocation_hours_planned":8.187739463601533,"allocation_hours_actual":0,"available_capacity":23.68965517241379,"total_capacity_cumulative":51.00383141762452,"cumulative_planned":13.100383141762451,"cumulative_actual":0,"available_capacity_cumulative":37.90344827586207},
            // ... (truncated for brevity, insert the rest of the JSON data here)
        ];

        const parseDate = d3.timeParse('%Y-%m-%d');
        data.forEach(d => {
            d.week_start = parseDate(d.week_start);
        });

        const svg = d3.select("#chart"),
              margin = {top: 20, right: 20, bottom: 30, left: 50},
              width = +svg.attr("width") - margin.left - margin.right,
              height = +svg.attr("height") - margin.top - margin.bottom,
              g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

        const x = d3.scaleTime()
            .range([0, width])
            .domain(d3.extent(data, d => d.week_start));

        const y = d3.scaleLinear()
            .range([height, 0])
            .domain([0, d3.max(data, d => d.total_capacity_cumulative)]);

        const lineTotalCapacity = d3.line()
            .x(d => x(d.week_start))
            .y(d => y(d.total_capacity_cumulative));

        const linePlanned = d3.line()
            .x(d => x(d.week_start))
            .y(d => y(d.cumulative_planned));

        const lineAvailable = d3.line()
            .x(d => x(d.week_start))
            .y(d => y(d.available_capacity_cumulative));

        g.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x).ticks(d3.timeMonth).tickFormat(d3.timeFormat("%b %Y")))
            .append("text")
            .attr("fill", "#000")
            .attr("x", width / 2)
            .attr("y", 25)
            .attr("dy", "0.71em")
            .attr("text-anchor", "end")
            .text("Time (Weekly)");

        g.append("g")
            .call(d3.axisLeft(y))
            .append("text")
            .attr("fill", "#000")
            .attr("transform", "rotate(-90)")
            .attr("y", -40)
            .attr("x", -height / 2)
            .attr("dy", "0.71em")
            .attr("text-anchor", "end")
            .text("Capacity (Cumulative Hours)");

        g.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", "blue")
            .attr("stroke-width", 1.5)
            .attr("d", lineTotalCapacity);

        g.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", "green")
            .attr("stroke-width", 1.5)
            .attr("d", linePlanned);

        g.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", "orange")
            .attr("stroke-width", 1.5)
            .attr("d", lineAvailable);

        const legendData = [
            { color: 'blue', label: 'Total Capacity Cumulative' },
            { color: 'green', label: 'Cumulative Planned' },
            { color: 'orange', label: 'Available Capacity Cumulative' }
        ];

        d3.select('#legend')
            .selectAll('.legend-item')
            .data(legendData)
            .enter()
            .append('div')
            .attr('class', 'legend-item')
            .html(d => `<span style="display: inline-block; width: 12px; height: 12px; background-color: ${d.color}; border-radius: 50%;"></span>${d.label}`);

        const tooltip = d3.select('#tooltip');

        svg.selectAll("path")
            .on("mouseover", function(event, d) {
                const mousePos = d3.pointer(event);
                tooltip.style("opacity", 1)
                       .html(`Week Start: ${d3.timeFormat("%B %d, %Y")(d.week_start)}<br>Total Capacity: ${d.total_capacity_cumulative}<br>Planned: ${d.cumulative_planned}<br>Available: ${d.available_capacity_cumulative}`)
                       .style("left", `${mousePos[0] + 5}px`)
                       .style("top", `${mousePos[1] + 5}px`);
            })
            .on("mouseout", function() {
                tooltip.style("opacity", 0);
            });
    </script>
</body>
</html>