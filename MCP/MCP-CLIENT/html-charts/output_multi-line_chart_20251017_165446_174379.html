<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Line Chart with D3.js v7</title>
    <style>
.domain { stroke-width: 1.5; }

        body {
            font-family: Arial, sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 1024px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .tooltip {
            position: absolute;
            background-color: white;
            border: 1px solid #d3d3d3;
            padding: 10px;
            display: none;
            pointer-events: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }
        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
        }
        .legend div {
            display: flex;
            align-items: center;
        }
        .legend div span {
            width: 12px;
            height: 12px;
            display: inline-block;
            margin-right: 8px;
            border-radius: 50%;
        }
    </style>
</head>
<body>

<div class="chart-container">
    <svg id="chart"></svg>
    <div class="tooltip" id="tooltip"></div>
</div>
<div class="legend">
    <div><span style="background-color: steelblue;"></span>Total Capacity</div>
    <div><span style="background-color: orange;"></span>Planned Allocation</div>
    <div><span style="background-color: green;"></span>Available Capacity</div>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
    const data = [
        { "week_start": "2025-01-01", "week_end": "2025-01-05", "total_capacity": 19.126, "allocation_hours_planned": 4.913, "allocation_hours_actual": 0, "available_capacity": 14.214 },
        { "week_start": "2025-01-06", "week_end": "2025-01-12", "total_capacity": 31.877, "allocation_hours_planned": 8.188, "allocation_hours_actual": 0, "available_capacity": 23.690 },
        //... Additional data skipped for brevity
        { "week_start": "2025-12-29", "week_end": "2025-12-31", "total_capacity": 19.126, "allocation_hours_planned": 18.000, "allocation_hours_actual": 0, "available_capacity": 1.126 }
    ];

    const width = 1000, height = 500;
    const margin = { top: 20, right: 30, bottom: 70, left: 60 };

    const x = d3.scaleTime()
        .domain(d3.extent(data, d => new Date(d.week_start)))
        .range([margin.left, width - margin.right]);

    const y = d3.scaleLinear()
        .domain([0, d3.max(data, d => d3.max([d.total_capacity, d.allocation_hours_planned, d.available_capacity]))])
        .nice()
        .range([height - margin.bottom, margin.top]);

    const xAxis = g => g
        .attr("transform", `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(x).ticks(width / 80).tickSizeOuter(0))
        .call(g => g.append("text")
            .attr("x", width - margin.right)
            .attr("y", 35)
            .attr("fill", "currentColor")
            .attr("text-anchor", "end")
            .text("Week Start"));

    const yAxis = g => g
        .attr("transform", `translate(${margin.left},0)`)
        .call(d3.axisLeft(y))
        .call(g => g.select(".domain").remove())
        .call(g => g.append("text")
            .attr("x", -margin.left)
            .attr("y", 10)
            .attr("dy", ".71em")
            .attr("fill", "currentColor")
            .attr("text-anchor", "start")
            .text("Hours"));

    const line = (yValue) => d3.line()
        .defined(d => !isNaN(d[yValue]))
        .x(d => x(new Date(d.week_start)))
        .y(d => y(d[yValue]));

    const svg = d3.select("#chart")
        .attr("viewBox", [0, 0, width, height]);

    svg.append("g")
        .call(xAxis);

    svg.append("g")
        .call(yAxis);

    svg.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "steelblue")
        .attr("stroke-width", 1.5)
        .attr("d", line("total_capacity"));

    svg.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "orange")
        .attr("stroke-width", 1.5)
        .attr("d", line("allocation_hours_planned"));

    svg.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "green")
        .attr("stroke-width", 1.5)
        .attr("d", line("available_capacity"));

    const tooltip = d3.select("#tooltip");

    svg.append("rect")
        .attr("class", "overlay")
        .attr("width", width - margin.left - margin.right)
        .attr("height", height - margin.top - margin.bottom)
        .attr("transform", `translate(${margin.left},${margin.top})`)
        .style("fill", "none")
        .style("pointer-events", "all")
        .on("mouseover", function(event) {
            tooltip.style("display", null);
        })
        .on("mouseout", function() {
            tooltip.style("display", "none");
        })
        .on("mousemove", function(event) {
            const bisectDate = d3.bisector(d => new Date(d.week_start)).left;
            const x0 = x.invert(d3.pointer(event)[0]);
            const index = bisectDate(data, x0, 1);
            const d0 = data[index - 1];
            const d1 = data[index];
            const d = x0 - new Date(d0.week_start) > new Date(d1.week_start) - x0 ? d1 : d0;
            tooltip
                .style("left", `${d3.pointer(event)[0] + 5}px`)
                .style("top", `${d3.pointer(event)[1] - 28}px`)
                .html(`<strong>Week Start: </strong>${d.week_start}<br><strong>Total Capacity: </strong>${d.total_capacity}<br><strong>Planned Allocation: </strong>${d.allocation_hours_planned}<br><strong>Available Capacity: </strong>${d.available_capacity}`);
        });

</script>
</body>
</html>