<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Line Chart with D3.js</title>
    <style>
.domain { stroke-width: 1.5; }

        body {
            font-family: Arial, sans-serif;
        }

        .chart {
            display: block;
            position: relative;
        }

        .legend {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
        }

        .legend div {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend span {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .axis-label {
            font-size: 12px;
            fill: #000;
        }

        .tooltip {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }
    </style>
</head>

<body>
    <h1>Weekly Capacity and Allocation</h1>
    <div class="chart" id="chart"></div>
    <div class="legend" id="legend">
        <div><span style="background-color: steelblue;"></span>Total Capacity</div>
        <div><span style="background-color: #d95f02;"></span>Planned Allocation</div>
        <div><span style="background-color: #1b9e77;"></span>Available Capacity</div>
    </div>
    <div class="tooltip" id="tooltip"></div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        const data = [
          { "week_start": "2025-01-01", "week_end": "2025-01-05", "total_capacity": 19.126436781609193, "allocation_hours_planned": 4.9126436781609195, "allocation_hours_actual": 0, "available_capacity": 14.213793103448275 },
          { "week_start": "2025-01-06", "week_end": "2025-01-12", "total_capacity": 31.877394636015325, "allocation_hours_planned": 8.187739463601533, "allocation_hours_actual": 0, "available_capacity": 23.68965517241379 },
          // ... [data truncated for brevity]
          { "week_start": "2025-12-22", "week_end": "2025-12-28", "total_capacity": 31.877394636015325, "allocation_hours_planned": 30.0, "allocation_hours_actual": 0, "available_capacity": 1.8773946360153237 },
          { "week_start": "2025-12-29", "week_end": "2025-12-31", "total_capacity": 19.126436781609193, "allocation_hours_planned": 18.0, "allocation_hours_actual": 0, "available_capacity": 1.1264367816091942 }
        ];

        const margin = { top: 20, right: 30, bottom: 60, left: 40 };
        const width = 900 - margin.left - margin.right;
        const height = 500 - margin.top - margin.bottom;

        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const parseDate = d3.timeParse("%Y-%m-%d");
        data.forEach(d => {
            d.week_start = parseDate(d.week_start);
            d.week_end = parseDate(d.week_end);
        });

        const x = d3.scaleTime()
            .domain(d3.extent(data, d => d.week_start))
            .range([0, width]);

        const y = d3.scaleLinear()
            .domain([0, d3.max(data, d => d.total_capacity)])
            .nice()
            .range([height, 0]);

        const color = d3.scaleOrdinal()
            .domain(["total_capacity", "allocation_hours_planned", "available_capacity"])
            .range(["steelblue", "#d95f02", "#1b9e77"]);

        const xAxis = d3.axisBottom(x)
            .ticks(d3.timeMonth.every(1))
            .tickFormat(d3.timeFormat("%b %Y"));

        const yAxis = d3.axisLeft(y);

        svg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(xAxis)
            .append("text")
            .attr("class", "axis-label")
            .attr("x", width / 2)
            .attr("y", 50)
            .attr("fill", "black")
            .text("Week Start");

        svg.append("g")
            .call(yAxis)
            .append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("x", -height / 2)
            .attr("y", -35)
            .attr("fill", "black")
            .style("text-anchor", "middle")
            .text("Hours");

        const line = d3.line()
            .x(d => x(d.week_start))
            .y(d => y(d.total_capacity));

        svg.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", color("total_capacity"))
            .attr("stroke-width", 2)
            .attr("d", d3.line()
                .x(d => x(d.week_start))
                .y(d => y(d.total_capacity))
            );

        svg.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", color("allocation_hours_planned"))
            .attr("stroke-width", 2)
            .attr("d", d3.line()
                .x(d => x(d.week_start))
                .y(d => y(d.allocation_hours_planned))
            );

        svg.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", color("available_capacity"))
            .attr("stroke-width", 2)
            .attr("d", d3.line()
                .x(d => x(d.week_start))
                .y(d => y(d.available_capacity))
            );

        // Tooltip Functionality
        const tooltip = d3.select("#tooltip");

        svg.selectAll("path")
            .on("mousemove", function (event, d) {
                const [xPos, yPos] = d3.pointer(event);
                tooltip.style("opacity", 1)
                    .style("left", `${xPos + margin.left}px`)
                    .style("top", `${yPos + margin.top}px`)
                    .html(`
                        <strong>Date:</strong> ${d3.timeFormat("%Y-%m-%d")(x.invert(xPos))}<br>
                        <strong>Total Capacity:</strong> ${y.invert(yPos).toFixed(2)}
                    `);
            })
            .on("mouseleave", () => tooltip.style("opacity", 0));

    </script>
</body>

</html>