<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js Multi-Line Chart</title>
    <style>
.domain { stroke-width: 1.5; }

        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .chart {
            max-width: 900px;
            margin: auto;
        }

        .axis-label {
            font-size: 14px;
            fill: #333;
        }

        .tooltip {
            position: absolute;
            background-color: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            pointer-events: none;
            display: none;
        }

        .legend {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
        }

        .legend-item {
            display: flex;
            align-items: center;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>Weekly Capacity and Allocation Analysis</h1>
    <div class="chart"></div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        const data = [
            {"week_start": "2025-01-01", "week_end": "2025-01-05", "total_capacity_cumulative": 19.1264, "cumulative_planned": 4.9126, "cumulative_actual": 0, "available_capacity_cumulative": 14.2138},
            {"week_start": "2025-01-06", "week_end": "2025-01-12", "total_capacity_cumulative": 51.0038, "cumulative_planned": 13.1004, "cumulative_actual": 0, "available_capacity_cumulative": 37.9034},
            {"week_start": "2025-01-13", "week_end": "2025-01-19", "total_capacity_cumulative": 82.8812, "cumulative_planned": 21.2881, "cumulative_actual": 0, "available_capacity_cumulative": 61.5931},
            {"week_start": "2025-01-20", "week_end": "2025-01-26", "total_capacity_cumulative": 114.7586, "cumulative_planned": 29.4759, "cumulative_actual": 0, "available_capacity_cumulative": 85.2828},
            {"week_start": "2025-01-27", "week_end": "2025-02-02", "total_capacity_cumulative": 146.6360, "cumulative_planned": 37.6636, "cumulative_actual": 0, "available_capacity_cumulative": 108.9724},
            {"week_start": "2025-02-03", "week_end": "2025-02-09", "total_capacity_cumulative": 178.5134, "cumulative_planned": 45.8513, "cumulative_actual": 0, "available_capacity_cumulative": 132.6621},
            {"week_start": "2025-02-10", "week_end": "2025-02-16", "total_capacity_cumulative": 210.3908, "cumulative_planned": 54.0391, "cumulative_actual": 0, "available_capacity_cumulative": 156.3517},
            {"week_start": "2025-02-17", "week_end": "2025-02-23", "total_capacity_cumulative": 242.2682, "cumulative_planned": 62.2268, "cumulative_actual": 0, "available_capacity_cumulative": 180.0414},
            {"week_start": "2025-02-24", "week_end": "2025-03-02", "total_capacity_cumulative": 274.1456, "cumulative_planned": 70.4146, "cumulative_actual": 0, "available_capacity_cumulative": 203.7310},
            {"week_start": "2025-03-03", "week_end": "2025-03-09", "total_capacity_cumulative": 306.0230, "cumulative_planned": 80.6023, "cumulative_actual": 0, "available_capacity_cumulative": 225.4207},
            {"week_start": "2025-03-10", "week_end": "2025-03-16", "total_capacity_cumulative": 337.9004, "cumulative_planned": 90.7900, "cumulative_actual": 0, "available_capacity_cumulative": 247.1103},
            {"week_start": "2025-03-17", "week_end": "2025-03-23", "total_capacity_cumulative": 369.7778, "cumulative_planned": 100.9778, "cumulative_actual": 0, "available_capacity_cumulative": 268.8000},
            {"week_start": "2025-03-24", "week_end": "2025-03-30", "total_capacity_cumulative": 401.6552, "cumulative_planned": 111.1655, "cumulative_actual": 0, "available_capacity_cumulative": 290.4897},
            {"week_start": "2025-03-31", "week_end": "2025-04-06", "total_capacity_cumulative": 433.5326, "cumulative_planned": 117.2031, "cumulative_actual": 0, "available_capacity_cumulative": 316.3295},
            {"week_start": "2025-04-07", "week_end": "2025-04-13", "total_capacity_cumulative": 465.4100, "cumulative_planned": 122.2031, "cumulative_actual": 0, "available_capacity_cumulative": 343.2069},
            {"week_start": "2025-04-14", "week_end": "2025-04-20", "total_capacity_cumulative": 497.2874, "cumulative_planned": 127.2031, "cumulative_actual": 0, "available_capacity_cumulative": 370.0843},
            {"week_start": "2025-04-21", "week_end": "2025-04-27", "total_capacity_cumulative": 529.1648, "cumulative_planned": 132.2031, "cumulative_actual": 0, "available_capacity_cumulative": 396.9617},
            {"week_start": "2025-04-28", "week_end": "2025-05-04", "total_capacity_cumulative": 561.0421, "cumulative_planned": 137.2031, "cumulative_actual": 0, "available_capacity_cumulative": 423.8391},
            {"week_start": "2025-05-05", "week_end": "2025-05-11", "total_capacity_cumulative": 592.9195, "cumulative_planned": 142.2031, "cumulative_actual": 0, "available_capacity_cumulative": 450.7165},
            {"week_start": "2025-05-12", "week_end": "2025-05-18", "total_capacity_cumulative": 624.7969, "cumulative_planned": 147.2031, "cumulative_actual": 0, "available_capacity_cumulative": 477.5939},
            {"week_start": "2025-05-19", "week_end": "2025-05-25", "total_capacity_cumulative": 656.6743, "cumulative_planned": 152.2031, "cumulative_actual": 0, "available_capacity_cumulative": 504.4713},
            {"week_start": "2025-05-26", "week_end": "2025-06-01", "total_capacity_cumulative": 688.5517, "cumulative_planned": 157.2031, "cumulative_actual": 0, "available_capacity_cumulative": 531.3487},
            {"week_start": "2025-06-02", "week_end": "2025-06-08", "total_capacity_cumulative": 720.4291, "cumulative_planned": 162.2031, "cumulative_actual": 0, "available_capacity_cumulative": 558.2261},
            {"week_start": "2025-06-09", "week_end": "2025-06-15", "total_capacity_cumulative": 752.3065, "cumulative_planned": 167.2031, "cumulative_actual": 0, "available_capacity_cumulative": 585.1034},
            {"week_start": "2025-06-16", "week_end": "2025-06-22", "total_capacity_cumulative": 784.1839, "cumulative_planned": 172.2031, "cumulative_actual": 0, "available_capacity_cumulative": 611.9808},
            {"week_start": "2025-06-23", "week_end": "2025-06-29", "total_capacity_cumulative": 816.0613, "cumulative_planned": 177.2031, "cumulative_actual": 0, "available_capacity_cumulative": 638.8582},
            {"week_start": "2025-06-30", "week_end": "2025-07-06", "total_capacity_cumulative": 847.9387, "cumulative_planned": 202.2031, "cumulative_actual": 0, "available_capacity_cumulative": 645.7356},
            {"week_start": "2025-07-07", "week_end": "2025-07-13", "total_capacity_cumulative": 879.8161, "cumulative_planned": 232.2031, "cumulative_actual": 0, "available_capacity_cumulative": 647.6130},
            {"week_start": "2025-07-14", "week_end": "2025-07-20", "total_capacity_cumulative": 911.6935, "cumulative_planned": 262.2031, "cumulative_actual": 0, "available_capacity_cumulative": 649.4904},
            {"week_start": "2025-07-21", "week_end": "2025-07-27", "total_capacity_cumulative": 943.5709, "cumulative_planned": 292.2031, "cumulative_actual": 0, "available_capacity_cumulative": 651.3678},
            {"week_start": "2025-07-28", "week_end": "2025-08-03", "total_capacity_cumulative": 969.0728, "cumulative_planned": 322.2031, "cumulative_actual": 0, "available_capacity_cumulative": 652.8697},
            {"week_start": "2025-08-04", "week_end": "2025-08-10", "total_capacity_cumulative": 969.0728, "cumulative_planned": 352.2031, "cumulative_actual": 0, "available_capacity_cumulative": 652.8697},
            {"week_start": "2025-08-11", "week_end": "2025-08-17", "total_capacity_cumulative": 969.0728, "cumulative_planned": 382.2031, "cumulative_actual": 0, "available_capacity_cumulative": 652.8697},
            {"week_start": "2025-08-18", "week_end": "2025-08-24", "total_capacity_cumulative": 969.0728, "cumulative_planned": 412.2031, "cumulative_actual": 0, "available_capacity_cumulative": 652.8697},
            {"week_start": "2025-08-25", "week_end": "2025-08-31", "total_capacity_cumulative": 969.0728, "cumulative_planned": 442.2031, "cumulative_actual": 0, "available_capacity_cumulative": 652.8697},
            {"week_start": "2025-09-01", "week_end": "2025-09-07", "total_capacity_cumulative": 1000.9502, "cumulative_planned": 472.2031, "cumulative_actual": 0, "available_capacity_cumulative": 654.7471},
            {"week_start": "2025-09-08", "week_end": "2025-09-14", "total_capacity_cumulative": 1032.8276, "cumulative_planned": 502.2031, "cumulative_actual": 0, "available_capacity_cumulative": 656.6245},
            {"week_start": "2025-09-15", "week_end": "2025-09-21", "total_capacity_cumulative": 1064.7050, "cumulative_planned": 532.2031, "cumulative_actual": 0, "available_capacity_cumulative": 658.5019},
            {"week_start": "2025-09-22", "week_end": "2025-09-28", "total_capacity_cumulative": 1096.5824, "cumulative_planned": 562.2031, "cumulative_actual": 0, "available_capacity_cumulative": 660.3793},
            {"week_start": "2025-09-29", "week_end": "2025-10-05", "total_capacity_cumulative": 1128.4598, "cumulative_planned": 592.2031, "cumulative_actual": 0, "available_capacity_cumulative": 662.2567},
            {"week_start": "2025-10-06", "week_end": "2025-10-12", "total_capacity_cumulative": 1160.3372, "cumulative_planned": 622.2031, "cumulative_actual": 0, "available_capacity_cumulative": 664.1341},
            {"week_start": "2025-10-13", "week_end": "2025-10-19", "total_capacity_cumulative": 1192.2146, "cumulative_planned": 652.2031, "cumulative_actual": 0, "available_capacity_cumulative": 666.0115},
            {"week_start": "2025-10-20", "week_end": "2025-10-26", "total_capacity_cumulative": 1224.0920, "cumulative_planned": 682.2031, "cumulative_actual": 0, "available_capacity_cumulative": 667.8889},
            {"week_start": "2025-10-27", "week_end": "2025-11-02", "total_capacity_cumulative": 1255.9693, "cumulative_planned": 712.2031, "cumulative_actual": 0, "available_capacity_cumulative": 669.7663},
            {"week_start": "2025-11-03", "week_end": "2025-11-09", "total_capacity_cumulative": 1287.8467, "cumulative_planned": 742.2031, "cumulative_actual": 0, "available_capacity_cumulative": 671.6437},
            {"week_start": "2025-11-10", "week_end": "2025-11-16", "total_capacity_cumulative": 1319.7241, "cumulative_planned": 772.2031, "cumulative_actual": 0, "available_capacity_cumulative": 673.5211},
            {"week_start": "2025-11-17", "week_end": "2025-11-23", "total_capacity_cumulative": 1351.6015, "cumulative_planned": 802.2031, "cumulative_actual": 0, "available_capacity_cumulative": 675.3985},
            {"week_start": "2025-11-24", "week_end": "2025-11-30", "total_capacity_cumulative": 1383.4789, "cumulative_planned": 832.2031, "cumulative_actual": 0, "available_capacity_cumulative": 677.2759},
            {"week_start": "2025-12-01", "week_end": "2025-12-07", "total_capacity_cumulative": 1415.3563, "cumulative_planned": 862.2031, "cumulative_actual": 0, "available_capacity_cumulative": 679.1533},
            {"week_start": "2025-12-08", "week_end": "2025-12-14", "total_capacity_cumulative": 1447.2337, "cumulative_planned": 892.2031, "cumulative_actual": 0, "available_capacity_cumulative": 681.0307},
            {"week_start": "2025-12-15", "week_end": "2025-12-21", "total_capacity_cumulative": 1479.1111, "cumulative_planned": 922.2031, "cumulative_actual": 0, "available_capacity_cumulative": 682.9080},
            {"week_start": "2025-12-22", "week_end": "2025-12-28", "total_capacity_cumulative": 1510.9885, "cumulative_planned": 952.2031, "cumulative_actual": 0, "available_capacity_cumulative": 684.7854},
            {"week_start": "2025-12-29", "week_end": "2025-12-31", "total_capacity_cumulative": 1530.1149, "cumulative_planned": 970.2031, "cumulative_actual": 0, "available_capacity_cumulative": 685.9119}
        ];

        const margin = {top: 20, right: 30, bottom: 50, left: 50},
              width = 900 - margin.left - margin.right,
              height = 500 - margin.top - margin.bottom;

        const svg = d3.select(".chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        const parseDate = d3.timeParse("%Y-%m-%d");
        data.forEach(d => {
            d.week_start = parseDate(d.week_start);
        });

        const x = d3.scaleTime()
            .domain(d3.extent(data, d => d.week_start))
            .range([0, width]);

        const y = d3.scaleLinear()
            .domain([0, d3.max(data, d => Math.max(d.total_capacity_cumulative, d.cumulative_planned, d.available_capacity_cumulative))])
            .nice()
            .range([height, 0]);

        svg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x).tickFormat(d3.timeFormat("%b %Y")).ticks(10));

        svg.append("g")
            .call(d3.axisLeft(y));

        const lineTotalCapacity = d3.line()
            .x(d => x(d.week_start))
            .y(d => y(d.total_capacity_cumulative));

        const linePlanned = d3.line()
            .x(d => x(d.week_start))
            .y(d => y(d.cumulative_planned));

        const lineAvailableCapacity = d3.line()
            .x(d => x(d.week_start))
            .y(d => y(d.available_capacity_cumulative));

        svg.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", "#1f77b4")
            .attr("stroke-width", 2)
            .attr("d", lineTotalCapacity);

        svg.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", "#ff7f0e")
            .attr("stroke-width", 2)
            .attr("d", linePlanned);

        svg.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", "#2ca02c")
            .attr("stroke-width", 2)
            .attr("d", lineAvailableCapacity);

        svg.append("text")
            .attr("text-anchor", "end")
            .attr("x", width/2)
            .attr("y", height + margin.bottom - 10)
            .attr("class", "axis-label")
            .text("Date");

        svg.append("text")
            .attr("text-anchor", "end")
            .attr("transform", "rotate(-90)")
            .attr("y", -margin.left + 15)
            .attr("x", -height / 2 + 10)
            .attr("class", "axis-label")
            .text("Cumulative Hours");

        const legend = [
            {name: "Total Capacity", color: "#1f77b4"},
            {name: "Planned Allocation", color: "#ff7f0e"},
            {name: "Available Capacity", color: "#2ca02c"}
        ];

        const legendContainer = d3.select("body")
            .append("div")
            .attr("class", "legend");

        legend.forEach(item => {
            const legendItem = legendContainer.append("div")
                .attr("class", "legend-item");

            legendItem.append("div")
                .attr("class", "legend-color")
                .style("background-color", item.color);

            legendItem.append("span")
                .text(item.name);
        });
    </script>
</body>
</html>