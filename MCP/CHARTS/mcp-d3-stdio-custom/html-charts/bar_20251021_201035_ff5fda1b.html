<!doctype html>
<html>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Sample Bar</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    body{font-family:Inter,Segoe UI,Arial,sans-serif;margin:20px;background:#f6f7fb;color:#111}
    .container{max-width:1100px;margin:0 auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 6px 30px rgba(20,30,60,0.08)}
    h2{margin:0 0 12px 0;font-size:18px}
    .viz{width:100%;height:520px}
    .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .legend-item{display:flex;align-items:center;gap:8px;font-size:13px}
    .sw{width:14px;height:14px;border-radius:3px}
</style>
</head>
<body>
<div class='container'>
<h2>Sample Bar</h2>
<div id='viz' class='viz'></div>
<div id='legend' class='legend' aria-hidden='false'></div>
<div style='margin-top:8px;color:#666;font-size:13px'>Generated by local D3 MCP server</div>
</div>
<script src='https://d3js.org/d3.v7.min.js'></script>
<script>
const data = {"labels": ["Q1", "Q2", "Q3"], "datasets": [{"label": "Revenue", "data": [120, 150, 170], "backgroundColor": "#ff7f0e"}]};

(function(){
const container = d3.select('#viz');
const rect = container.node().getBoundingClientRect();
const margin = {top:20,right:20,bottom:80,left:60};
const rectWidth = rect.width || container.node().clientWidth || document.documentElement.clientWidth || window.innerWidth || 800;
const rectHeight = rect.height || container.node().clientHeight || document.documentElement.clientHeight || window.innerHeight || 520;
const width = Math.max(300, rectWidth) - margin.left - margin.right;
const height = Math.max(200, rectHeight) - margin.top - margin.bottom;
const svg = container.append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom)
  .append('g').attr('transform', `translate(${margin.left},${margin.top})`);
const labels = data.labels || [];
const datasets = data.datasets || [];
const x0 = d3.scaleBand().domain(labels).range([0,width]).padding(0.2);
const x1 = d3.scaleBand().padding(0.05);
const y = d3.scaleLinear().range([height,0]);
if(false){
  // stacked: compute stacks
  const series = d3.stack().keys(d3.range(datasets.length))(labels.map((l,i)=>datasets.map(ds=>ds.data[i]||0)));
  y.domain([0,d3.max(series, s=>d3.max(s, d=>d[1]))||0]);
  x1.domain(d3.range(datasets.length)).range([0,x0.bandwidth()]);
  svg.append('g').attr('transform',`translate(0,${height})`).call(d3.axisBottom(x0)).selectAll('text').attr('transform','rotate(-40)').style('text-anchor','end');
  svg.append('g').call(d3.axisLeft(y));
  const colors = datasets.map((d,i)=>d.backgroundColor||d.borderColor||d3.schemeTableau10[i%10]);
  const groups = svg.selectAll('g.layer').data(series).enter().append('g').attr('class','layer').attr('fill',(d,i)=>colors[i]);
  groups.selectAll('rect').data(d=>d).enter().append('rect').attr('x',(d,i)=>x0(labels[i])).attr('y',d=>y(d[1])).attr('height',d=>y(d[0])-y(d[1])).attr('width',x0.bandwidth());
  datasets.forEach((ds,i)=>{ d3.select('#legend').append('div').attr('class','legend-item').html(`<div class='sw' style='background:${colors[i]}'></div><div>${ds.label}</div>`); });
} else {
  x1.domain(d3.range(datasets.length)).range([0,x0.bandwidth()]);
  const maxv = d3.max(datasets, ds=>d3.max(ds.data||[]))||0; y.domain([0,maxv]);
  svg.append('g').attr('transform',`translate(0,${height})`).call(d3.axisBottom(x0)).selectAll('text').attr('transform','rotate(-40)').style('text-anchor','end');
  svg.append('g').call(d3.axisLeft(y));
  const barGroups = svg.selectAll('g.bar-group').data(labels).enter().append('g').attr('transform',d=>`translate(${x0(d)},0)`);
  barGroups.selectAll('rect').data((d,i)=>datasets.map(ds=>({key:ds.label,value:ds.data[i]||0, color:ds.backgroundColor||ds.borderColor}))).enter().append('rect')
    .attr('x',(d,i)=>x1(i)).attr('y',d=>y(d.value)).attr('width',x1.bandwidth()).attr('height',d=>height-y(d.value)).attr('fill',d=>d.color||'#777');
  datasets.forEach((ds,i)=>{ d3.select('#legend').append('div').attr('class','legend-item').html(`<div class='sw' style='background:${ds.backgroundColor||ds.borderColor||d3.schemeTableau10[i%10]}'></div><div>${ds.label}</div>`); });
}
})();

</script>
</body>
</html>
