<!doctype html>
<html>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Sample Packed</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    body{font-family:Inter,Segoe UI,Arial,sans-serif;margin:20px;background:#f6f7fb;color:#111}
    .container{max-width:1100px;margin:0 auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 6px 30px rgba(20,30,60,0.08)}
    h2{margin:0 0 12px 0;font-size:18px}
    .viz{width:100%;height:520px}
    .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .legend-item{display:flex;align-items:center;gap:8px;font-size:13px}
    .sw{width:14px;height:14px;border-radius:3px}
</style>
</head>
<body>
<div class='container'>
<h2>Sample Packed</h2>
<div id='viz' class='viz'></div>
<div id='legend' class='legend' aria-hidden='false'></div>
<div style='margin-top:8px;color:#666;font-size:13px'>Generated by local D3 MCP server</div>
</div>
<script src='https://d3js.org/d3.v7.min.js'></script>
<script>
const data = {"items": [{"id": "A", "label": "A", "value": 40, "color": "#1f77b4"}, {"id": "B", "label": "B", "value": 60, "color": "#ff7f0e"}, {"id": "C", "label": "C", "value": 20, "color": "#2ca02c"}]};

(function(){
const container = d3.select('#viz');
const payload = data || {};
const items = payload.items || payload.data || [];
if(!items || !items.length){ container.append('div').text('No packed data (expect items: [{id,label,value,color}])'); return; }
// build hierarchy root
const root = { name: 'root', children: items.map(i=>({ name: i.id || i.label || i.name || String(i), value: +i.value || 0, color: i.color })) };
const rect = container.node().getBoundingClientRect();
const width = Math.max(320, rect.width || container.node().clientWidth || window.innerWidth) ;
const height = Math.max(320, rect.height || container.node().clientHeight || window.innerHeight) ;
const svg = container.append('svg').attr('width', width).attr('height', height).append('g').attr('transform','translate(0,0)');
const pack = d3.pack().size([width, height]).padding(4);
const hierarchy = d3.hierarchy(root).sum(d=>d.value||0).sort((a,b)=>b.value - a.value);
pack(hierarchy);
const node = svg.selectAll('g.node').data(hierarchy.leaves()).enter().append('g').attr('transform', d=>`translate(${d.x},${d.y})`);
node.append('circle').attr('r', d=>d.r).attr('fill', (d,i)=> d.data.color || d3.schemeTableau10[i % 10]).attr('stroke','#fff').attr('stroke-width',1);
node.append('title').text(d=>d.data.name + ': ' + (d.data.value||0));
node.append('text').attr('dy', '.3em').style('text-anchor','middle').style('font-size','11px').text(d=>d.data.name.length > 12 ? d.data.name.slice(0,10)+'..' : d.data.name);
// legend simple
const legend = d3.select('#legend'); items.slice(0,8).forEach(function(it,i){ legend.append('div').attr('class','legend-item').html(`<div class='sw' style='background:${it.color||d3.schemeTableau10[i%10]}'></div><div>${it.label||it.id||it.name||''} â€” ${it.value||0}</div>`); });
})();

</script>
</body>
</html>
