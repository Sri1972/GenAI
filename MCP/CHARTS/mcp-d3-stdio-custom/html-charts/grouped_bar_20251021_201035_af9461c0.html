<!doctype html>
<html>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<title>Sample Grouped Bar</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    body{font-family:Inter,Segoe UI,Arial,sans-serif;margin:20px;background:#f6f7fb;color:#111}
    .container{max-width:1100px;margin:0 auto;background:#fff;padding:20px;border-radius:8px;box-shadow:0 6px 30px rgba(20,30,60,0.08)}
    h2{margin:0 0 12px 0;font-size:18px}
    .viz{width:100%;height:520px}
    .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .legend-item{display:flex;align-items:center;gap:8px;font-size:13px}
    .sw{width:14px;height:14px;border-radius:3px}
</style>
</head>
<body>
<div class='container'>
<h2>Sample Grouped Bar</h2>
<div id='viz' class='viz'></div>
<div id='legend' class='legend' aria-hidden='false'></div>
<div style='margin-top:8px;color:#666;font-size:13px'>Generated by local D3 MCP server</div>
</div>
<script src='https://d3js.org/d3.v7.min.js'></script>
<script>
const data = {"labels": ["2019", "2020", "2021"], "datasets": [{"label": "A", "data": [10, 20, 30], "backgroundColor": "#2ca02c"}, {"label": "B", "data": [15, 25, 18], "backgroundColor": "#d62728"}]};

(function(){
const payload = data||{}; const labels = payload.labels||[]; const datasets = payload.datasets||[]; if(!labels.length||!datasets.length){ d3.select('#viz').append('div').text('No grouped bar data'); return; }
const rect = d3.select('#viz').node().getBoundingClientRect(); const width = Math.max(320, rect.width)-60; const height = Math.max(240, rect.height)-60;
const svg = d3.select('#viz').append('svg').attr('width', width).attr('height', height).append('g').attr('transform','translate(40,20)');
const x0 = d3.scaleBand().domain(labels).range([0, width-80]).padding(0.2);
const x1 = d3.scaleBand().domain(d3.range(datasets.length)).range([0, x0.bandwidth()]).padding(0.05);
const y = d3.scaleLinear().domain([0, d3.max(datasets, ds=>d3.max(ds.data||[]))||0]).range([height-80,0]);
const colors = datasets.map((d,i)=>d.backgroundColor||d.borderColor||d3.schemeTableau10[i%10]);
const groups = svg.selectAll('g').data(labels).enter().append('g').attr('transform', d=>`translate(${x0(d)},0)`);
groups.selectAll('rect').data((d,i)=>datasets.map(ds=>({v:ds.data[i]||0, color: ds.backgroundColor||ds.borderColor}))).enter().append('rect').attr('x',(d,i)=>x1(i)).attr('y',d=>y(d.v)).attr('width',x1.bandwidth()).attr('height',d=>height-80 - y(d.v)).attr('fill',d=>d.color||'#777');
svg.append('g').attr('transform',`translate(0,${height-80})`).call(d3.axisBottom(x0));
})();

</script>
</body>
</html>
